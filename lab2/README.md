# Robust Object Tracker

## 1. Теоретическая база

Задача трекинга объектов в видеопоследовательностях заключается в устойчивом определении положения объекта на каждом кадре при наличии шума, размытия, изменений масштаба, поворота, частичных окклюзий и изменения освещённости. На практике эффективные системы трекинга строятся как комбинация методов детекции и методов межкадрового сопровождения.

В данной работе используются следующие теоретические подходы:

**Ключевые точки и дескрипторы.** Алгоритмы SIFT, ORB и AKAZE позволяют выделять устойчивые к масштабированию и поворотам ключевые точки и описывать их локальными дескрипторами. Сопоставление дескрипторов между шаблоном и кадром позволяет обнаружить объект даже при существенных геометрических искажениях.

**Lowe Ratio Test.** Для фильтрации ложных соответствий используется отношение расстояний между ближайшими дескрипторами, что существенно повышает надёжность матчинга.

**RANSAC и гомография.** Для оценки геометрического преобразования между шаблоном и кадром применяется алгоритм RANSAC, позволяющий устойчиво оценить гомографию при наличии выбросов. Гомография используется для восстановления положения и формы объекта на текущем кадре.

**Оптический поток Лукаса–Канаде (LK).** После успешной детекции объект сопровождается межкадрово с помощью оптического потока, что значительно быстрее повторной полной детекции и снижает вычислительную нагрузку.

**Фильтр Калмана.** Для сглаживания траектории и стабилизации положения центра объекта используется линейный фильтр Калмана, компенсирующий шум измерений и мелкие потери ключевых точек.

---

## 2. Описание разработанной системы

### Общая архитектура

Система реализована в виде модульного Python-приложения и состоит из следующих основных компонентов:

- `main.py` — точка входа приложения и обработка аргументов командной строки;
- `config.py` — централизованное хранилище параметров детекции, трекинга и фильтрации;
- `tracker.py` — основной класс `RobustObjectTracker`, реализующий логику детекции и трекинга;
- `video_utils.py` — утилиты для работы с видео, выбора шаблона и визуализации результатов.

### Принцип работы алгоритма

1. Пользователь выбирает регион интереса (ROI) на первом кадре видео, который используется как шаблон объекта.
2. На основе шаблона строится набор его вариаций с различными масштабами и углами поворота (мульти-скейл и мульти-ориентация).
3. Для каждого кадра выполняется:
   - **Режим детекции**:
     - вычисление ключевых точек и дескрипторов;
     - сопоставление с шаблоном (FLANN или BFMatcher);
     - фильтрация соответствий по Lowe ratio и согласованности масштаба;
     - оценка гомографии с помощью RANSAC;
     - инициализация режима трекинга при успешной детекции.
   - **Режим трекинга**:
     - сопровождение ключевых точек с помощью LK optical flow;
     - повторная оценка гомографии;
     - корректировка положения объекта фильтром Калмана.
4. При деградации качества трекинга происходит автоматический возврат к режиму детекции.

### Ключевые особенности системы

- поддержка нескольких детекторов (SIFT, ORB, AKAZE);
- устойчивость к размытию и изменениям освещённости за счёт предобработки (CLAHE + Laplacian);
- адаптивные пороги RANSAC, зависящие от размеров объекта;
- сглаживание результата по истории bounding box и фильтру Калмана;
- интерактивный режим работы и отладочная визуализация.

---

## 3. Результаты работы и тестирования системы

Тестирование проводилось на видеопоследовательностях с размытием и искажениями, включая файлы:

- `mona-lisa-blur.avi`
- `mona-lisa-blur-extra-credit.avi`

Параметры запуска:

```bash
python main.py --input mona-lisa-blur.avi --output result.mp4 --detector sift --max-variants 12
```

Результаты тестирования:

- количество кадров: 557;
- количество успешных обнаружений: 557;
- процент успешного трекинга: **100%**;
- время обработки: ~7.5–8.0 секунд на видеопоследовательность.

Система продемонстрировала устойчивую работу даже при сильном размытии, без заметных срывов трекинга и с плавным положением ограничивающей рамки.

---

## 4. Выводы по работе

В ходе выполнения работы была разработана и реализована комбинированная система трекинга объектов, объединяющая методы детекции по ключевым точкам и межкадрового сопровождения. Экспериментальные результаты показали высокую надёжность и устойчивость алгоритма к размытию, изменениям масштаба и поворотам объекта.

Использование гибридного подхода (детекция + LK + фильтр Калмана) позволило достичь высокой точности при приемлемых вычислительных затратах. Архитектура системы допускает дальнейшее расширение, включая замену детекторов, добавление GPU-ускорения или интеграцию с нейросетевыми методами.

---

## 5. Использованные источники

1. Lowe D. G. *Distinctive Image Features from Scale-Invariant Keypoints*. IJCV, 2004.
2. Lucas B. D., Kanade T. *An Iterative Image Registration Technique with an Application to Stereo Vision*. IJCAI, 1981.
3. Hartley R., Zisserman A. *Multiple View Geometry in Computer Vision*. Cambridge University Press, 2004.
4. OpenCV Documentation — Feature Detection, Optical Flow, Kalman Filter.
5. Szeliski R. *Computer Vision: Algorithms and Applications*. Springer, 2010.
